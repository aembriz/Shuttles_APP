<br/>
<br/>
<br/>	
<div class="container-fluid form-full">
	<script src="js/holder/holder.js"></script>
	<link href="css/mapa.css" rel="stylesheet">
	<script src="js/mapa.js"></script>
    <h1 class="page-header">Mis Rutas
		<div style="float:right;">
			<a type="button" class="btn btn-info btn-xs" ng-show="showFavoritos == true" ng-click="filtraFavoritos()">
				Ver todas las rutas
			</a>
			<a type="button" class="btn btn-warning btn-xs" ng-show="showFavoritos != true" ng-click="filtraFavoritos()">
				<span class="glyphicon glyphicon-star"></span>Ver solo rutas favoritas
			</a>
		</div>
    </h1>
	<link href="css/panels.css" rel="stylesheet">
	<link href="css/modal.css" rel="stylesheet">    

	<div class="alert alert-danger alert-dismissable" ng-show="(errMsg != null)&&(errMsg != '')">
	  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
	  <strong>Error!</strong> {{errMsg}}
	</div>
	<div class="alert alert-success alert-dismissable" ng-show="(sucMsg != null)&&(sucMsg != '')">
	  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
	  {{sucMsg}}
	</div>  
	<img ng-show="(rutas==null)&&(errMsg == null)" alt="Loading  Content" src="imgs/loading.gif" height="25px" />		
	<div bn-slide-show="message!=''" slide-show-duration="500" style="float: center" ng-class="messageType">
		<p ng-bind-html="message"></p>
	</div>
	<div class="table-responsive">
		<table class="table table-striped">
			<thead>
				<tr>
					<th width="1%">
						<a type="button" class="btn btn-warning btn-xs" ng-show="showFavoritos == true" ng-click="filtraFavoritos()">
							<span class="glyphicon glyphicon-star"></span>
						</a>
						<a type="button" class="btn btn-default btn-xs" ng-show="showFavoritos != true" ng-click="filtraFavoritos()">
							<span class="glyphicon glyphicon-star-empty"></span>
						</a>
					</th>
					<th width="10%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='id'"><b>ID</b></a></span>
							<input ng-model="query.id" type="text" class="form-control input-sm" placeholder="ID" />
						</div>
					</th>
					<th width="15%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='companyownernombre'"><b>Empresa</b></a></span>
							<input ng-model="query.companyownernombre" type="text" class="form-control input-sm" placeholder="Empresa" />
						</div>
					</th>
					<th width="15%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='nombre'"><b>Nombre</b></a></span>
							<input ng-model="query.nombre" type="text" class="form-control input-sm" placeholder="Nombre" />
						</div>
					</th>
					<th width="20%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='origentxt'"><b>Origen</b></a></span>
							<input ng-model="query.origentxt" type="text" class="form-control input-sm" placeholder="Origen" />
						</div>
					</th>
					<th width="20%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='destinotxt'"><b>Destino</b></a></span>
							<input ng-model="query.destinotxt" type="text" class="form-control input-sm" placeholder="Destino" />
						</div>
					</th>	
					<!--
					<th width="4%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='recorridoParadas'"><b>Paradas</b></a></span>
							v>
					</th>					
					<th width="4%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='capacidadReservada'"><b>Reservado</b></a></span>
						</div>
					</th>					
					<th width="4%">
						<div class="input-group">
							<span class="input-group-addon"><a href="" ng-click="orderProp='capacidadOfertada'"><b>Ofertado</b></a></span>
						</div>
					</th>						-->
					<th>-</th>
				</tr>
			</thead>
			<tbody>			
				<tr ng-repeat="ruta in rutas | filter:query | orderBy:orderProp">
					<td ng-show="ruta.isFavorite == true">
						<a type="button"  class="btn btn-warning btn-xs" ng-click="favorito(ruta)">
							<span class="glyphicon glyphicon-star"></span>
						</a>
					</td>
					<td ng-show="ruta.isFavorite != true">
						<a type="button"  class="btn btn-default btn-xs" ng-click="favorito(ruta)">
							<span class="glyphicon glyphicon-star-empty"></span>
						</a>
					</td>
					<td>{{ruta.id}}</td>
					<td>{{ruta.companyownernombre}}</td>
					<td><a href="#/usuarioRutaShow/{{ruta.id}}">{{ruta.nombre}}</a></td>
					<td>{{ruta.origentxt}}</td>
					<td>{{ruta.destinotxt}}</td>
					<!--
					<td>{{ruta.recorridoParadas}}</td>
					<td>{{ruta.capacidadReservada}}</td>
					<td>{{ruta.capacidadOfertada}}</td>	
				-->
					<td>
						<!--
						<a type="button" class="btn btn-info" href="#/usuarioRutaShow/{{ruta.id}}"><span class="glyphicon glyphicon-zoom-in"></span></a>-->
						<a type="button" class="btn btn-info" ng-click="showMapa(ruta)"><span class="glyphicon glyphicon-map-marker"></span></a>						
						<!--<a type="button" class="btn btn-info" href="#/usuarioCorridaList/{{ruta.id}}"><span class="glyphicon glyphicon-calendar"></span></a>-->
						<a type="button" class="btn btn-info" ng-click="showCompraList(ruta)"><span class="glyphicon glyphicon-usd"></span></a>

	
						<!--
						<a type="button" class="btn btn-info" href="#/empresaRutaShow/{{ruta.id}}"><span class="glyphicon glyphicon-zoom-in"></span></a>
						<a type="button" class="btn btn-info" href="#/empresaMapaShow/{{ruta.id}}"><span class="glyphicon glyphicon-map-marker"></span></a>						
						<a type="button" class="btn btn-info" href="#/empresaCorridaList/{{ruta.id}}"><span class="glyphicon glyphicon-calendar"></span></a>
						<a type="button" class="btn btn-danger" ng-click="deleteRuta(ruta.id)"><span class="glyphicon glyphicon-remove"></span></a>
					-->
					</td>

				</tr>
			</tbody>
		</table>		
		
	</div>

	<!-- Modal - Corrida de las rutas -->
	<div class="modal fade modal-wide" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
		    <div class="modal-content">

		      	<div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			        <h4 class="modal-title" id="myModalLabel">{{selRuta.nombre}}</h4>	
		    	</div>
		    	<div class="modal-header" ng-show="((errMsg != null)&&(errMsg != ''))||(sucMsg != null)&&(sucMsg != '')">
					<div class="alert alert-danger alert-dismissable" ng-show="(errMsg != null)&&(errMsg != '')">
					  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
					  <strong>Error!</strong> {{errMsg}}
					</div>
					<div class="alert alert-success alert-dismissable" ng-show="(sucMsg != null)&&(sucMsg != '')">
					  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
					  {{sucMsg}}
					</div>
				</div>
		    	<div class="modal-body">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th><a href="" ng-click="orderProp='id'">ID</a></th>
									<th><a href="" ng-click="orderProp='horaSalidaFmt'">Hora de salida</a></th>
									<th><a href="" ng-click="orderProp='horaLlegadaFmt'">Hora de llegada</a></th>
									<th><a href="" ng-click="orderProp='oferta'">Lugares disponibles</a></th>
									<th><a href="" ng-click="orderProp='tarifa'">Tarifa (MX$)</a></th>
									<th>Folio</th>
								</tr>
							</thead>

							<tbody>		
								<tr ng-repeat-start="corrida in corridas | filter:query | orderBy:orderProp">
									<tr class="info" ng-show="corrida.cambiaFecha">
										<td colspan="6"><b>{{corrida.fecha}}
										
										</b></td>
									</tr>
									<td>{{corrida.id}}</td>
									<td>{{corrida.rutaCorrida.horaSalidaFmt}}</td>
									<td>{{corrida.rutaCorrida.horaLlegadaFmt}}</td>
									<td>{{corrida.oferta}}</td>
									<td>${{corrida.rutaCorrida.tarifa}}</td>
									<td>
										<!-- ESPERA con oferta -->
										<p ng-show="(corrida.oferta > 0) && (corrida.espera == null)"></p>
										<p ng-show="(corrida.oferta > 0) && (corrida.espera != null)">Lista de espera {{corrida.espera.folio}} </p>
										<!-- ESPERA sin oferta -->
										<p ng-show="(corrida.oferta <= 0) && (corrida.espera != null)">Lista de espera {{corrida.espera.folio}} </p>
										<a ng-show="(corrida.oferta <= 0) && (corrida.espera == null) && (corrida.reservacion == null)" type="button" class="btn btn-warning" ng-click="esperar(corrida)">Lista de espera</a>

										<!-- RESERVACION con oferta -->
										<a ng-show="(corrida.oferta > 0) && (corrida.reservacion == null) && (corrida.espera == null)" type="button" class="btn btn-success" ng-click="reservar(corrida)">Reservar</a>
										<b ng-show="(corrida.oferta > 0) && (corrida.reservacion != null)">Reservaci&oacute;n {{corrida.reservacion.folio}} </b>
									
										<!-- RESERVACION sin oferta -->
										<b ng-show="(corrida.oferta <= 0) && (corrida.reservacion != null)">Reservaci&oacute;n {{corrida.reservacion.folio}} </b>
										<b ng-show="(corrida.oferta <= 0) && (corrida.reservacion == null)"></b>

								        <a type="button" class="btn btn-info btn-xs" data-toggle="collapse" data-target="#oferta{{corrida.id}}" class="accordion-toggle"><span class="glyphicon glyphicon-calendar"></span></a>


									</td>
								</tr>
							    <tr ng-repeat-end>	
							      <td class="hiddenRow" colspan="6" align="right">
							        <div class="accordion-body collapse" id="oferta{{corrida.id}}">

										<div class="input-group">
											<span class="input-group-addon">
												<a ng-show="(corrida.rutaCorrida.capacidadReservada - corrida.rutaCorrida.reservacionesRecurrentes > 0)" type="button" class="btn btn-success" ng-click="reservarRecurrente(corrida)">Siempre ap&aacute;rtame lugar</a> Para los d&iacute;as: 																				
											</span>
											<span class="input-group-addon" ng-show="corrida.rutaCorrida.dia1==true">
												<ul class="nav nav-pills">
													<li class="active" ng-show="corrida.rutaCorrida.dia1==true"><a>Lun</a></li>
													<li ng-show="corrida.rutaCorrida.dia1==false"><a>Lun</a></li>
												</ul>
											</span>
											<span class="input-group-addon" ng-show="corrida.rutaCorrida.dia2==true">
												<ul class="nav nav-pills">
													<li class="active" ng-show="corrida.rutaCorrida.dia2==true"><a>Mar</a></li>
													<li ng-show="corrida.rutaCorrida.dia2==false"><a>Mar</a></li>
												</ul>
											</span>
											<span class="input-group-addon" ng-show="corrida.rutaCorrida.dia3==true">
												<ul class="nav nav-pills">
													<li class="active" ng-show="corrida.rutaCorrida.dia3==true"><a>Mi&eacute;</a></li>
													<li ng-show="corrida.rutaCorrida.dia3==false"><a>Mi&eacute;</a></li>
												</ul>
											</span>
											<span class="input-group-addon" ng-show="corrida.rutaCorrida.dia4==true">
												<ul class="nav nav-pills">
													<li class="active" ng-show="corrida.rutaCorrida.dia4==true"><a>Jue</a></li>
													<li ng-show="corrida.rutaCorrida.dia4==false"><a>Jue</a></li>
												</ul>
											</span>
											<span class="input-group-addon" ng-show="corrida.rutaCorrida.dia5==true">
												<ul class="nav nav-pills">
													<li class="active" ng-show="corrida.rutaCorrida.dia5==true"><a>Vie</a></li>
													<li ng-show="corrida.rutaCorrida.dia5==false"><a>Vie</a></li>
												</ul>
											</span>
											<span class="input-group-addon" ng-show="corrida.rutaCorrida.dia6==true">
												<ul class="nav nav-pills">
													<li class="active" ng-show="corrida.rutaCorrida.dia6==true"><a>Sab</a></li>
													<li ng-show="corrida.rutaCorrida.dia6==false"><a>Sab</a></li>
												</ul>
											</span>
											<span class="input-group-addon" ng-show="corrida.rutaCorrida.dia7==true">
												<ul class="nav nav-pills">
													<li class="active" ng-show="corrida.rutaCorrida.dia7==true"><a>Dom</a></li>
													<li ng-show="corrida.rutaCorrida.dia7==false"><a>Dom</a></li>
												</ul>
											</span>
										</div>	
									</div>
							      </td>

							    </tr>		
							</tbody>
						</table>
					</div>				

		    	</div>

			    <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
			        <!--
			        <button type="button" class="btn btn-success">Salvar cambios</button>
			    -->
			    </div>
			
	    	</div>
	  	</div>
	</div>	<!-- End Modal -->	

	<!-- Modal - Corrida de las rutas -->
	<div class="modal fade modal-wide" id="mapaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
		    <div class="modal-content">

		      	<div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			        <h4 class="modal-title" id="myModalLabel">{{selRuta.nombre}}</h4>	
		    	</div>
		    	<div class="modal-header" ng-show="((errMsg != null)&&(errMsg != ''))||(sucMsg != null)&&(sucMsg != '')">
					<div class="alert alert-danger alert-dismissable" ng-show="(errMsg != null)&&(errMsg != '')">
					  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
					  <strong>Error!</strong> {{errMsg}}
					</div>
					<div class="alert alert-success alert-dismissable" ng-show="(sucMsg != null)&&(sucMsg != '')">
					  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
					  {{sucMsg}}
					</div>
				</div>
		    	<div class="modal-body">
					<div class="box efecto3" id="map_canvas" style="width: 92%; height: 100%"></div>			

					<div class="panel-body" align="center">
						<div id="consulta" ng-show="pMapa != null">
							<table class="table table-striped">
								<thead>
									<tr>
										<!--                <th>ID</th>-->
										<th>Marcador</th>
										<th>Tipo</th>
										<th>Descripci&oacute;n</th>
										<!--<th>Latitud</th>
										<th>Longitud</th>-->
									</tr>
								</thead>
								<tbody>
									<img ng-show="(pMapa==null)&&(errMsg == null)" alt="Loading  Content" src="imgs/loading.gif" height="25px" />    
									<div bn-slide-show="message!=''" slide-show-duration="500" style="float: center" ng-class="messageType">
										<p ng-bind-html="message"></p>
									</div>            
									<tr ng-repeat="emp in pMapa | filter:query | orderBy:orderProp ">
										<!--<td>{{emp.id}}</td>-->
										<td ng-show="emp.tipo == 1" align="center" width="1%"><span><img src="imgs/1.png" alt="Origen"/><span/></td>
										<td ng-show="emp.tipo == 2" align="center"><span><img src="imgs/2.png" alt="Destino"/><span/></td>
										<td ng-show="emp.tipo == 3" align="center"><span><img src="imgs/3.png" alt="Parada"/><span/></td>
										<td ng-show="emp.tipo == 4" align="center"><span><img src="imgs/4.png" alt="Vuelta"/><span/></td>

										<td ng-show="emp.tipo == 1">Inicio</td>
										<td ng-show="emp.tipo == 2">Final</td>
										<td ng-show="emp.tipo == 3">Parada</td>
										<td ng-show="emp.tipo == 4">Vuelta</td>
										<td>{{emp.descripcion}}</td>
										<!--<td>{{emp.latitud}}</td>
										<td>{{emp.longitud}}</td>-->
									</tr>
								</tbody>
							</table>
						</div>
					</div>		    		
		    	</div>

			    <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
			        <!--
			        <button type="button" class="btn btn-success">Salvar cambios</button>
			    -->
			    </div>
			
	    	</div>
	  	</div>
	</div>	<!-- End Modal -->	
</div>